随笔--linux设备驱动模型
=======================

> 以`kobject`为底层，组织`类class`、`总线bus`、`设备device`、`驱动driver`等高级数据结构，同时实现对象引用计数、维护对象链表、对象上锁、对用户空间的表示等服务

[TOC]

### linux设备驱动模型简介

    何谓linux驱动设备模型。其实驱动开发中已经涉及到这方面的知识，并且也用到驱动设备模型，只是并没有从驱动设备模型这个角度去理解
    文章站在设备驱动这个角度取分析，设备驱动模型是如何构建出来的，代码是谁写的，起到什么作用，要对它认识到一个怎么样的程度以及写
    驱动的时候如何去利用设备驱动模型

####什么是设备驱动模型
> 从以下几个角度去描述折别驱动模型

1. 类class、总线bus、设备device、驱动driver


        这四个词并不是四个简单的概念，这四个东西分别是我们linux驱动的四个结构体，也就是说这是我们linux设备驱动模型的四个框架。
        分别对应我们源代码的四个结构体。
            class ：例如class_create
            bus   ：例如USB总线，SPI总线
            device：设备
            driver：驱动
        我们要这四个结构体干嘛-----生产这些结构体类型的变量，每一个结构体变量就能代表一个实例

2. kobject和对象生命周期的管理


        linux内核源代码里面的一个结构体，k是kernel object物体，kobject就是内核的一个东西。一个高度抽象的结构体，表示我们内
        核里面的一个对象，就是内核里面的所有对象抽象出来的一个总类。所以我们说linux内核是面向对象编程。这个kobject就有点像面
        向对象体系的一个总的基类，总的父类
        对象生命周期，例如某一个驱动，insmod诞生，rmmod消亡。如何管理这个对象的生命周期呢？在kobject有一种机制，能够让每一个
        对象具有自我管理生命周期的特性，就是自己管理自己，当自身不被需要的时候就自己释放。比如为A malloc 申请一段内存，当不需
        要的时候不用去free A，它自己会自己free掉。那他怎么就知道自己没用了呢？肯定需要一种方法

3. sysfs

        在内核空间和我们用户空间建立一个映射关系
        
4. udev

        为了实现内核空间和用户空间的信息的一个同步
        
####为什么需要设备驱动模型

(1)早期内核（2.4之前）没有统一的设备驱动模型，但照样可以用<br>
(2)2.6版本中正式引入设备驱动模型，目的是在设备越来越多，功耗要求等新特性要求的情况下让驱动体系更易用、更优秀<br>
(3)设备驱动模型负责统一实现和维护一些特性，诸如：电源管理、热插拔、对象生命周期、用户空间和驱动空间的交互等基础设施




### 设备驱动模型的底层架构




### 总线式设备驱动组织方式





> 驱动这个东西并不复杂，就是由我们讲的这些理论来指导，就是由我们的实践来构成







